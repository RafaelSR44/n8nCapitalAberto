{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "empresa-research",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "86ea7ff9-442a-45b2-945d-a294dff9b68f",
      "name": "Webhook",
      "webhookId": "d36b7798-9570-4cce-aaf6-696bd0716133"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n        \"success\": true,\n        \"message\": \"An√°lise iniciada com sucesso\",\n        \"empresa\": \"={{ $('Edit Fields').item.json['\"empresa\"'] }}\",\n        \"documentUrl\": \"https://docs.google.com/document/d/{{ $('Google Docs').item.json.id }}/edit\",\n        \"documentId\": \"={{ $('Google Docs').item.json.id }}\",\n        \"timestamp\": \"={{ $('Edit Fields').item.json['\"timestamp\"'] }}\"\n      }",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2040,
        0
      ],
      "id": "ff9b5364-13ae-46b1-aec8-f505fe8ee57e",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "31c0b619-a3a5-4178-93af-b3611c5dbf51",
              "name": "\"empresa\"",
              "value": "={{ $json.body.empresa }}",
              "type": "string"
            },
            {
              "id": "9eb60aab-fdbb-48e8-8946-a065086011f1",
              "name": "\"timestamp\"",
              "value": "={{ $json.body.timestamp }}",
              "type": "string"
            },
            {
              "id": "7c500e36-9cd0-43ab-bea6-71a09c12692c",
              "name": "\"documentTitle\"",
              "value": "=An√°lise -  {{ $json.body.empresa }} - {{ $now.format('DD HH:mm') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        220,
        0
      ],
      "id": "98a2be06-f408-4c5d-9f7f-77bae149bae4",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8f47ec9a-ea12-4960-8633-f358c73f7975",
              "name": "geminiAnalysis",
              "value": "=={{ $json.candidates[0].content.parts[0].text }}",
              "type": "string"
            },
            {
              "id": "312d859b-3ff4-49e1-884e-13659a70d42b",
              "name": "empresa",
              "value": "={{ $('Edit Fields').item.json.empresa }}",
              "type": "string"
            },
            {
              "id": "ab0c82f3-e2ae-476f-98ad-e6725099b72a",
              "name": "documentTitle",
              "value": "={{ $('Edit Fields').item.json.documentTitle }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1340,
        0
      ],
      "id": "9a5df26d-1e3c-44a6-b32f-8068c66b5059",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "driveId": "=myDrive",
        "folderId": "={{ $json.id }}",
        "title": "={{ $('Edit Fields').item.json['\"documentTitle\"'] }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        1680,
        0
      ],
      "id": "73687994-9507-4691-b164-897b794c29e8",
      "name": "Google Docs",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "dNyd2iiB0dSWoQpl",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $json.id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "={{ $('Edit Fields1').item.json.geminiAnalysis }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        1860,
        0
      ],
      "id": "788247b4-160d-4c6b-b913-389b9f01a955",
      "name": "Google Docs1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "dNyd2iiB0dSWoQpl",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDJMc2Ucinf6Zn7aRUO5AJHBhIxRHf9lEE",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "contents",
              "value": "={{ $('Edit Fields2').item.json.contents }}"
            },
            {
              "name": "generationConfig",
              "value": "={{ $('Edit Fields2').item.json.generationConfig[0] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1160,
        0
      ],
      "id": "229e38ca-c925-4b57-a674-429628c67f53",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74b68604-4064-412f-b208-2e0ffb25975b",
              "name": "contents",
              "value": "={{   [         {           \"parts\": [             {               \"text\": \"Voc√™ √© um analista s√™nior de Investment Banking especializado no mercado brasileiro de capitais.Voc√™ receber√° dados, que devem ser analisados e tratados, sobre uma empresa brasileira listada na B3, incluindo:\\n1. **Dados Sobre a empresa** - Informa√ß√µes sobre a empresa\\n2. **Dados de Cota√ß√£o** (formatacaoQuote) - Informa√ß√µes financeiras e de mercado\\n3. **Dados de Not√≠cias** (formatacaoNews) - Not√≠cias recentes sobre a empresa \\n---\\n\\n## DADOS RECEBIDOS:\\n ### üìä INFORMA√á√ïES DE COTA√á√ÉO:\\n '\"+ $json.formatacaoQuote + \"' \\n ### üì∞ NOT√çCIAS COLETADAS: \\n '\"+ $json.formatacaoNews + \"'\\n\\n---\\n\\n## INSTRU√á√ïES DE PROCESSAMENTO:\\n\\n### üîç An√°lise das Not√≠cias:\\n1. Avalie TODAS as not√≠cias fornecidas no array articles\\n2. Selecione as 3 MAIS RELEVANTES baseado nos crit√©rios:\\n   - Impacto financeiro direto na empresa\\n   - Relev√¢ncia operacional (resultados, projetos, mudan√ßas estrat√©gicas)\\n   - Atualidade (priorize not√≠cias mais recentes)\\n   - Fonte confi√°vel (InfoMoney, Valor, Reuters, etc.)\\n3. Descarte not√≠cias sobre:\\n   - Mercado geral sem men√ß√£o espec√≠fica da empresa\\n   - An√°lises t√©cnicas gen√©ricas do Ibovespa\\n   - Not√≠cias repetitivas ou similares\\n\\n### üìà An√°lise da Cota√ß√£o:\\n1. Extraia os dados mais relevantes do JSON de cota√ß√£o\\n2. Calcule m√©tricas importantes quando poss√≠vel\\n3. Interprete os indicadores no contexto do mercado brasileiro\\n\\n---\\n\\n## ESTRUTURA OBRIGAT√ìRIA DO RELAT√ìRIO:\\n\\n# üìä AN√ÅLISE EMPRESARIAL - {NOME_EMPRESA} ({TICKER})\\n\\n**Data da An√°lise:** {DATA_ATUAL}  \\n**Ticker:** {TICKER}  \\n**Raz√£o Social:** {NOME_COMPLETO}  \\n---\\n\\n## üè¢ PERFIL CORPORATIVO\\n\\n**Funda√ß√£o:** {Ano e contexto}\\n**Sede:** {Localiza√ß√£o}\\n**Principais Atividades:** {Core business detalhado}\\n**Posicionamento:** {Market share, ranking setorial}\\n**Modelo de Neg√≥cio:** {Revenue streams principais}\\n\\n---\\n\\n## üí∞ RESUMO FINANCEIRO\\n\\n**Pre√ßo Atual:** R$ {PRECO_ATUAL}  \\n**Varia√ß√£o Di√°ria:** {VARIACAO_PERCENTUAL}% ({VARIACAO_ABSOLUTA})  \\n**Abertura:** R$ {PRECO_ABERTURA}  \\n**M√°xima do Dia:** R$ {MAXIMA_DIA}  \\n**M√≠nima do Dia:** R$ {MINIMA_DIA}  \\n**Volume:** {VOLUME_FORMATADO}  \\n\\n**Varia√ß√£o 52 Semanas:** R$ {MIN_52S} - R$ {MAX_52S}  \\n**Market Cap:** R$ {MARKET_CAP_FORMATADO}  \\n**P/L:** {PE_RATIO}  \\n**LPA:** R$ {EARNINGS_PER_SHARE}  \\n\\n---\\n\\n## üìà AN√ÅLISE DE PERFORMANCE\\n\\n### Contexto Atual\\n{AN√ÅLISE_DO_PRE√áO_ATUAL_EM_RELA√á√ÉO_AOS_RANGES}\\n\\n### Indicadores T√©cnicos\\n{INTERPRETA√á√ÉO_DOS_M√öLTIPLOS_E_M√âTRICAS}\\n\\n---\\n\\n## üì∞ NOT√çCIAS MAIS RELEVANTES\\n\\n### üî• Not√≠cia 1: {T√çTULO_NOT√çCIA_1}\\n**Data:** {DATA_NOT√çCIA_1}  \\n**Link:** {LINK_NOT√çCIA_1}  \\n**Resumo:** {RESUMO_EXECUTIVO_2_3_LINHAS}  \\n**Impacto:** {AN√ÅLISE_DO_IMPACTO_PARA_INVESTIDORES}  \\n\\n### üìä Not√≠cia 2: {T√çTULO_NOT√çCIA_2}  \\n**Data:** {DATA_NOT√çCIA_2}  \\n**Link:** {LINK_NOT√çCIA_2}  \\n**Resumo:** {RESUMO_EXECUTIVO_2_3_LINHAS}  \\n**Impacto:** {AN√ÅLISE_DO_IMPACTO_PARA_INVESTIDORES}  \\n\\n### üíº Not√≠cia 3: {T√çTULO_NOT√çCIA_3}\\n**Data:** {DATA_NOT√çCIA_3}  \\n**Link:** {LINK_NOT√çCIA_3}  \\n**Resumo:** {RESUMO_EXECUTIVO_2_3_LINHAS}  \\n**Impacto:** {AN√ÅLISE_DO_IMPACTO_PARA_INVESTIDORES}  \\n\\n---\\n\\n## üéØ AN√ÅLISE INTEGRADA\\n\\n### S√≠ntese dos Dados\\n{COMBINE_INFORMA√á√ïES_DE_COTA√á√ÉO_E_NOT√çCIAS_PARA_CRIAR_UMA_VIS√ÉO_HOL√çSTICA}\\n\\n### Pontos de Aten√ß√£o\\n- {RISCOS_IDENTIFICADOS_NAS_NOT√çCIAS}\\n- {OPORTUNIDADES_IDENTIFICADAS}\\n- {FATORES_T√âCNICOS_RELEVANTES}\\n\\n### Catalisadores Potenciais\\n- {EVENTOS_FUTUROS_MENCIONADOS_NAS_NOT√çCIAS}\\n- {MARCOS_T√âCNICOS_IMPORTANTES}\\n\\n---\\n\\n##!DISCLAIMERS\\n\\n- **Dados de Mercado:** Baseados na √∫ltima sess√£o dispon√≠vel\\n- **Not√≠cias:** Selecionadas por relev√¢ncia e impacto potencial  \\n- **N√£o √© Recomenda√ß√£o:** Este documento √© apenas informativo\\n- **Verifica√ß√£o:** Recomenda-se confirma√ß√£o em fontes oficiais\\n- **Risco:** Todo investimento envolve riscos\\n\\n---\\n\\n**Relat√≥rio Gerado por:** Sistema Automatizado de Investment Banking  \\n**Modelo:** Gemini 1.5 Flash  \\n**Timestamp:** {TIMESTAMP_GERACAO}\\n\\n---\\n\\n## REGRAS CR√çTICAS:\\n\\n###**DEVE FAZER:**\\n- Usar APENAS dados fornecidos, excluindo a se√ß√£o \\\"üè¢ PERFIL CORPORATIVO\\\" que deve buscar informa√ß√µes sobre\\n- Formatar valores monet√°rios em Real brasileiro (R$)\\n- Datar todas as informa√ß√µes adequadamente\\n- Focar em aspectos relevantes para Investment Banking\\n- Manter linguagem t√©cnica e profissional\\n- Quantificar impactos quando poss√≠vel\\n\\n###**N√ÉO DEVE FAZER:**\\n- Inventar dados n√£o presentes\\n- Fazer recomenda√ß√µes de compra/venda\\n- Usar informa√ß√µes de fontes externas aos dados fornecidos\\n- Repetir not√≠cias com conte√∫do similar\\n- Incluir an√°lises especulativas sem base nos dados\\n\\n### **CRIT√âRIOS PARA SELE√á√ÉO DE NOT√çCIAS:**\\n\\n**Prioridade Alta:**\\n- Resultados trimestrais/anuais\\n- Dividendos e proventos\\n- Mudan√ßas na gest√£o\\n- Grandes investimentos/desinvestimentos\\n- Aquisi√ß√µes/fus√µes\\n- Aprova√ß√µes regulat√≥rias importantes\\n\\n**Prioridade M√©dia:**\\n- An√°lises de bancos de investimento\\n- Mudan√ßas de rating\\n- Not√≠cias setoriais espec√≠ficas\\n- Parcerias estrat√©gicas\\n\\n**Prioridade Baixa:**\\n- Not√≠cias do mercado geral\\n- An√°lises t√©cnicas do Ibovespa\\n- Coment√°rios gen√©ricos sobre o setor\\n\\n---\\n\\n## EXEMPLO DE FORMATA√á√ÉO DE VALORES:\\n\\n- **Monetary:** R$ 32,53 (n√£o $32.53)\\n- **Percentage:** +2,46% (n√£o 2.46%)\\n- **Volume:** 74,8 milh√µes (n√£o 74819900)\\n- **Market Cap:** R$ 400,6 bilh√µes (n√£o 400583262534)\\n\\n---\\n\\n**EXECUTE A AN√ÅLISE AGORA COM OS DADOS FORNECIDOS.** Caso os dados n√£o aparecem de forma clara, apresente no final do documento como eles foram apresentados\"             }           ]         }       ] }}",
              "type": "array"
            },
            {
              "id": "11f406b1-7cfa-43c4-9aa4-ad611699aff6",
              "name": "=generationConfig",
              "value": "={{ [{         \"temperature\": 0.3,         \"maxOutputTokens\": 2048,         \"topP\": 0.8,         \"topK\": 40       }] }}",
              "type": "array"
            },
            {
              "id": "305a0600-d10c-4590-9b85-47dc2727c1c2",
              "name": "teste",
              "value": "={{ $json.formatacaoNews }}",
              "type": "string"
            },
            {
              "id": "1717a0e8-42bd-4bdc-9b76-024ad7cec2de",
              "name": "teste",
              "value": "={{ $json.formatacaoQuote }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        980,
        0
      ],
      "id": "af1a6685-d118-4a44-8d1b-131878de20cd",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "url": "https://generativelanguage.googleapis.com/v1beta/models?key=AIzaSyDJMc2Ucinf6Zn7aRUO5AJHBhIxRHf9lEE",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1140,
        320
      ],
      "id": "8e1ad557-59ee-498c-b165-704ddf4776f4",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $('Edit Fields').item.json['\"empresa\"'] }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1H2kob3X-wW5IUp2C11yngi4_zplU6hT-",
          "mode": "list",
          "cachedResultName": "projetoEstagio",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1H2kob3X-wW5IUp2C11yngi4_zplU6hT-"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1500,
        0
      ],
      "id": "97de815a-efc1-42c7-a06e-2dd8ded95a83",
      "name": "Google Drive",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "er9TRIusJqfNFnKf",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "url": "= https://brapi.dev/api/quote/{{ $('Edit Fields').item.json['\"empresa\"'] }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "token",
              "value": "=75n89yAs7bAXEnv3qhUmYG"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        440,
        0
      ],
      "id": "9a618cb4-cdd0-41f0-8494-224528de3348",
      "name": "BRAPI-QUOTE"
    },
    {
      "parameters": {
        "url": "=https://newsapi.org/v2/everything",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $('Edit Fields').item.json['\"empresa\"'] }}"
            },
            {
              "name": "language",
              "value": "=pt"
            },
            {
              "name": "sortBy",
              "value": "publishedAt"
            },
            {
              "name": "apiKey",
              "value": "435135c72b464258b4f0d8ccff7906cf"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        640,
        0
      ],
      "id": "c7197e56-a5ce-4313-9de1-9605d772106b",
      "name": "NEWSAPI-NEWS"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cef7bd22-ee59-4379-b8cd-3a1265e6ee6d",
              "name": "formatacaoNews",
              "value": "={{ $json.articles }}",
              "type": "string"
            },
            {
              "id": "e334ec39-e94d-4ad7-bef7-25c30b2485a6",
              "name": "formatacaoQuote",
              "value": "={{ $('BRAPI-QUOTE').item.json.results }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        820,
        0
      ],
      "id": "492e7c9d-654a-484c-adf6-601299b33fa6",
      "name": "Edit Fields3"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "BRAPI-QUOTE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Docs": {
      "main": [
        [
          {
            "node": "Google Docs1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Docs1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        []
      ]
    },
    "Google Drive": {
      "main": [
        [
          {
            "node": "Google Docs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BRAPI-QUOTE": {
      "main": [
        [
          {
            "node": "NEWSAPI-NEWS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NEWSAPI-NEWS": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "e608c1c4-f1cb-4752-abad-5d737da39203",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "f703af88e39c1bdf94c33361d2b3287ee191ca47808bb38bf2428e19901c623a"
  },
  "id": "J5XzbIICEwZTFscv",
  "tags": []
}